<!doctype html>
<html ng-app="AMail">
	<head>
		<title>My Angular App</title>
		<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.0/angular.min.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.0/angular-route.min.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.0/angular-sanitize.min.js"></script>
	</head>
<body>

	<div ng-view>
	</div>

	<script>

		angular.module('AMail', ['ngRoute', 'ngSanitize'])
		.controller('ListController', function($scope, $http){
			
			$http.get('/api/get_recent_posts/').
			success(function(data, status, headers, config) {
				$scope.title = "Sitio Web";
				$scope.messages = data.posts;
			}).
			error(function(data, status, headers, config) {
			  // log error
			});
			
		}).controller('DetailController', function($scope, $routeParams, $http){
			$http.get('/api/get_post/?slug='+[$routeParams.slug]).
			success(function(data, status, headers, config) {
				$scope.title = data.post.title;
				$scope.message = data.post;
			}).
			error(function(data, status, headers, config) {
			  // log error
			});
		})
		.config(['$httpProvider', '$routeProvider', function ($httpProvider, $routeProvider) {
			$routeProvider
			.when('/', {
        		controller: 'ListController',
        		templateUrl: 'views/list.html'
        	}).
      		when('/:slug', {
		        controller: 'DetailController',
		        templateUrl: 'views/detail.html'
			}).
			otherwise({
				redirectTo: '/'
			});

		}]);

	    
	</script>
</body>
</html>